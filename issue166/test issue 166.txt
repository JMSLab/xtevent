-------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\tino_\Dropbox\PC\Documents\xtevent\issues\166\test issue 166.txt
  log type:  text
 opened on:  26 Oct 2023, 01:59:39

. 
. ******* test issue 166
. 
. *Setup
. webuse nlswork, clear
(National Longitudinal Survey.  Young Women 14-26 years of age in 1968)

. *year variable has many missing observations.
. *Create a time variable that ignores these gaps.
. by idcode (year): gen time=_n

. xtset idcode time
       panel variable:  idcode (unbalanced)
        time variable:  time, 1 to 15
                delta:  1 unit

. *Generate a policy variable that follows staggered adoption.
. by idcode (time): gen union2 = sum(union)

. replace union2 = 1 if union2 > 1
(4,177 real changes made)

. 
. 
. ******** default estimation (no trend adjustment)
. qui xtevent ln_w age c.age#c.age ttl_exp c.ttl_exp#c.ttl_exp tenure , pol(union2) w(-5 9) cluster(idcode) impute(
> stag)

. xteventplot //overid tests are added by default

. 
. xteventtest, coefs(1 2)

 ( 1)  _k_eq_p1 = 0
 ( 2)  _k_eq_p2 = 0

       F(  2,   711) =    7.05
            Prob > F =    0.0009

. xteventtest, allpre 

Test for all pre-event coefficients = 0

 ( 1)  _k_eq_m6 = 0
 ( 2)  _k_eq_m5 = 0
 ( 3)  _k_eq_m4 = 0
 ( 4)  _k_eq_m3 = 0
 ( 5)  _k_eq_m2 = 0

       F(  5,   711) =    2.24
            Prob > F =    0.0487

. xteventtest, allpost 

Test for all post-event coefficients = 0

 ( 1)  _k_eq_p0 = 0
 ( 2)  _k_eq_p1 = 0
 ( 3)  _k_eq_p2 = 0
 ( 4)  _k_eq_p3 = 0
 ( 5)  _k_eq_p4 = 0
 ( 6)  _k_eq_p5 = 0
 ( 7)  _k_eq_p6 = 0
 ( 8)  _k_eq_p7 = 0
 ( 9)  _k_eq_p8 = 0
 (10)  _k_eq_p9 = 0
 (11)  _k_eq_p10 = 0

       F( 11,   711) =    3.16
            Prob > F =    0.0003

. xteventtest, constanteff 

Test for constant post-event coefficients

 ( 1)  _k_eq_p0 - _k_eq_p1 = 0
 ( 2)  _k_eq_p0 - _k_eq_p2 = 0
 ( 3)  _k_eq_p0 - _k_eq_p3 = 0
 ( 4)  _k_eq_p0 - _k_eq_p4 = 0
 ( 5)  _k_eq_p0 - _k_eq_p5 = 0
 ( 6)  _k_eq_p0 - _k_eq_p6 = 0
 ( 7)  _k_eq_p0 - _k_eq_p7 = 0
 ( 8)  _k_eq_p0 - _k_eq_p8 = 0
 ( 9)  _k_eq_p0 - _k_eq_p9 = 0
 (10)  _k_eq_p0 - _k_eq_p10 = 0

       F( 10,   711) =    1.22
            Prob > F =    0.2749

. xteventtest, overid 

Overidentification test for pretrends: 5 pre-event coefficients are 0

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

Overidentification test for pretrends: 5 pre-event coefficients are 0

 ( 1)  _k_eq_m6 = 0
 ( 2)  _k_eq_m5 = 0
 ( 3)  _k_eq_m4 = 0
 ( 4)  _k_eq_m3 = 0
 ( 5)  _k_eq_m2 = 0

       F(  5,   711) =    2.24
            Prob > F =    0.0487

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

 ( 1)  - _k_eq_p9 + _k_eq_p10 = 0

       F(  1,   711) =    0.62
            Prob > F =    0.4307

Joint overidentification test

 ( 1)  _k_eq_m6 = 0
 ( 2)  _k_eq_m5 = 0
 ( 3)  _k_eq_m4 = 0
 ( 4)  _k_eq_m3 = 0
 ( 5)  _k_eq_m2 = 0
 ( 6)  - _k_eq_p9 + _k_eq_p10 = 0

       F(  6,   711) =    2.03
            Prob > F =    0.0594

. xteventtest, overidpre(2) 

Overidentification test for pretrends: 2 pre-event coefficients are 0

 ( 1)  _k_eq_m6 = 0
 ( 2)  _k_eq_m5 = 0

       F(  2,   711) =    3.17
            Prob > F =    0.0427

. xteventtest, overidpost(2) 

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

 ( 1)  - _k_eq_p9 + _k_eq_p10 = 0

       F(  1,   711) =    0.62
            Prob > F =    0.4307

. 
. ********* Adjust the pre-trend by estimating a linear trend by OLS & window option
. qui xtevent ln_w age c.age#c.age ttl_exp c.ttl_exp#c.ttl_exp tenure , pol(union2) w(-5 9) cluster(idcode) impute(
> stag) trend(-3, method(ols) saveoverlay) 

. xteventplot 

. xteventplot, overlay(trend) 

. 
. xteventtest, coefs(1 2)

 ( 1)  _k_eq_p1 = 0
 ( 2)  _k_eq_p2 = 0

       F(  2,   711) =    1.92
            Prob > F =    0.1476

. xteventtest, allpre //-6 should not be considered 

Test for all pre-event coefficients = 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    1.98
            Prob > F =    0.1386

. xteventtest, allpost // 10 should not be considered

Test for all post-event coefficients = 0

 ( 1)  _k_eq_p0 = 0
 ( 2)  _k_eq_p1 = 0
 ( 3)  _k_eq_p2 = 0
 ( 4)  _k_eq_p3 = 0
 ( 5)  _k_eq_p4 = 0
 ( 6)  _k_eq_p5 = 0
 ( 7)  _k_eq_p6 = 0
 ( 8)  _k_eq_p7 = 0
 ( 9)  _k_eq_p8 = 0
 (10)  _k_eq_p9 = 0

       F( 10,   711) =    6.01
            Prob > F =    0.0000

. xteventtest, constanteff // 10 should not be considered

Test for constant post-event coefficients

 ( 1)  _k_eq_p0 - _k_eq_p1 = 0
 ( 2)  _k_eq_p0 - _k_eq_p2 = 0
 ( 3)  _k_eq_p0 - _k_eq_p3 = 0
 ( 4)  _k_eq_p0 - _k_eq_p4 = 0
 ( 5)  _k_eq_p0 - _k_eq_p5 = 0
 ( 6)  _k_eq_p0 - _k_eq_p6 = 0
 ( 7)  _k_eq_p0 - _k_eq_p7 = 0
 ( 8)  _k_eq_p0 - _k_eq_p8 = 0
 ( 9)  _k_eq_p0 - _k_eq_p9 = 0

       F(  9,   711) =    2.40
            Prob > F =    0.0109

. xteventtest, overid // -6 and 10 should not be considered

Overidentification test for pretrends: 2 pre-event coefficients are 0

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

Overidentification test for pretrends: 2 pre-event coefficients are 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    1.98
            Prob > F =    0.1386

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

 ( 1)  - _k_eq_p8 + _k_eq_p9 = 0

       F(  1,   711) =    1.32
            Prob > F =    0.2504

Joint overidentification test

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0
 ( 3)  - _k_eq_p8 + _k_eq_p9 = 0

       F(  3,   711) =    1.37
            Prob > F =    0.2514

. xteventtest, overidpre(2) // -6 should not be considered

Overidentification test for pretrends: 2 pre-event coefficients are 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    1.98
            Prob > F =    0.1386

. xteventtest, overidpost(2) // 10 should not be considered

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

 ( 1)  - _k_eq_p8 + _k_eq_p9 = 0

       F(  1,   711) =    1.32
            Prob > F =    0.2504

. 
. ******* Adjust the pre-trend by estimating a linear trend by GMM & window option
. qui xtevent ln_w age c.age#c.age ttl_exp c.ttl_exp#c.ttl_exp tenure , pol(union2) w(-5 9) cluster(idcode) impute(
> stag) trend(-3, method(gmm) saveoverlay) 

. xteventplot 

. 
. xteventtest, coefs(1 2)

 ( 1)  _k_eq_p1 = 0
 ( 2)  _k_eq_p2 = 0

       F(  2,   711) =    1.63
            Prob > F =    0.1967

. xteventtest, allpre  

Test for all pre-event coefficients = 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0
 ( 3)  _k_eq_m3 = 0
 ( 4)  _k_eq_m2 = 0

       F(  4,   711) =    2.83
            Prob > F =    0.0240

. xteventtest, allpost 

Test for all post-event coefficients = 0

 ( 1)  _k_eq_p0 = 0
 ( 2)  _k_eq_p1 = 0
 ( 3)  _k_eq_p2 = 0
 ( 4)  _k_eq_p3 = 0
 ( 5)  _k_eq_p4 = 0
 ( 6)  _k_eq_p5 = 0
 ( 7)  _k_eq_p6 = 0
 ( 8)  _k_eq_p7 = 0
 ( 9)  _k_eq_p8 = 0
 (10)  _k_eq_p9 = 0

       F( 10,   711) =    4.69
            Prob > F =    0.0000

. xteventtest, constanteff 

Test for constant post-event coefficients

 ( 1)  _k_eq_p0 - _k_eq_p1 = 0
 ( 2)  _k_eq_p0 - _k_eq_p2 = 0
 ( 3)  _k_eq_p0 - _k_eq_p3 = 0
 ( 4)  _k_eq_p0 - _k_eq_p4 = 0
 ( 5)  _k_eq_p0 - _k_eq_p5 = 0
 ( 6)  _k_eq_p0 - _k_eq_p6 = 0
 ( 7)  _k_eq_p0 - _k_eq_p7 = 0
 ( 8)  _k_eq_p0 - _k_eq_p8 = 0
 ( 9)  _k_eq_p0 - _k_eq_p9 = 0

       F(  9,   711) =    1.79
            Prob > F =    0.0664

. xteventtest, overid 

Overidentification test for pretrends: 4 pre-event coefficients are 0

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

Overidentification test for pretrends: 4 pre-event coefficients are 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0
 ( 3)  _k_eq_m3 = 0
 ( 4)  _k_eq_m2 = 0

       F(  4,   711) =    2.83
            Prob > F =    0.0240

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

 ( 1)  - _k_eq_p8 + _k_eq_p9 = 0

       F(  1,   711) =    1.13
            Prob > F =    0.2885

Joint overidentification test

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0
 ( 3)  _k_eq_m3 = 0
 ( 4)  _k_eq_m2 = 0
 ( 5)  - _k_eq_p8 + _k_eq_p9 = 0

       F(  5,   711) =    2.31
            Prob > F =    0.0427

. xteventtest, overidpre(2) 

Overidentification test for pretrends: 2 pre-event coefficients are 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    4.38
            Prob > F =    0.0129

. xteventtest, overidpost(2) 

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

 ( 1)  - _k_eq_p8 + _k_eq_p9 = 0

       F(  1,   711) =    1.13
            Prob > F =    0.2885

. 
. ************ pre,post, overidpre, overidpost 
. qui xtevent ln_w age c.age#c.age ttl_exp c.ttl_exp#c.ttl_exp tenure , pol(union2) overidpre(5) pre(0) post(8) ove
> ridpost(2) cluster(idcode) impute(stag) trend(-3, method(ols) saveoverlay) 

. 
. xteventtest, coefs(1 2)

 ( 1)  _k_eq_p1 = 0
 ( 2)  _k_eq_p2 = 0

       F(  2,   711) =    1.92
            Prob > F =    0.1476

. xteventtest, allpre  

Test for all pre-event coefficients = 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    1.98
            Prob > F =    0.1386

. xteventtest, allpost 

Test for all post-event coefficients = 0

 ( 1)  _k_eq_p0 = 0
 ( 2)  _k_eq_p1 = 0
 ( 3)  _k_eq_p2 = 0
 ( 4)  _k_eq_p3 = 0
 ( 5)  _k_eq_p4 = 0
 ( 6)  _k_eq_p5 = 0
 ( 7)  _k_eq_p6 = 0
 ( 8)  _k_eq_p7 = 0
 ( 9)  _k_eq_p8 = 0
 (10)  _k_eq_p9 = 0

       F( 10,   711) =    6.01
            Prob > F =    0.0000

. xteventtest, constanteff 

Test for constant post-event coefficients

 ( 1)  _k_eq_p0 - _k_eq_p1 = 0
 ( 2)  _k_eq_p0 - _k_eq_p2 = 0
 ( 3)  _k_eq_p0 - _k_eq_p3 = 0
 ( 4)  _k_eq_p0 - _k_eq_p4 = 0
 ( 5)  _k_eq_p0 - _k_eq_p5 = 0
 ( 6)  _k_eq_p0 - _k_eq_p6 = 0
 ( 7)  _k_eq_p0 - _k_eq_p7 = 0
 ( 8)  _k_eq_p0 - _k_eq_p8 = 0
 ( 9)  _k_eq_p0 - _k_eq_p9 = 0

       F(  9,   711) =    2.40
            Prob > F =    0.0109

. xteventtest, overid // since overidpre(5) it will try to test the first 5 coefficients for the pre-trend test. It
>   inherits from xtevent the value for overidpre

overidpre value from  xtevent is 5, but available pre-event coefficients are 2 after trend adjustment with OLS meth
> od.

The pretrend test will account only the 2 available pre-event coefficients.

Overidentification test for pretrends: 2 pre-event coefficients are 0

Overidentification test for effects leveling off: 3 last post-event coefficients are equal

Overidentification test for pretrends: 2 pre-event coefficients are 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    1.98
            Prob > F =    0.1386

Overidentification test for effects leveling off: 3 last post-event coefficients are equal

 ( 1)  - _k_eq_p8 + _k_eq_p9 = 0
 ( 2)  - _k_eq_p7 + _k_eq_p9 = 0

       F(  2,   711) =    1.22
            Prob > F =    0.2971

Joint overidentification test

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0
 ( 3)  - _k_eq_p8 + _k_eq_p9 = 0
 ( 4)  - _k_eq_p7 + _k_eq_p9 = 0

       F(  4,   711) =    1.08
            Prob > F =    0.3630

. xteventtest, overidpre(2) 

Overidentification test for pretrends: 2 pre-event coefficients are 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    1.98
            Prob > F =    0.1386

. xteventtest, overidpost(2) 

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

 ( 1)  - _k_eq_p8 + _k_eq_p9 = 0

       F(  1,   711) =    1.32
            Prob > F =    0.2504

. cap noisily xteventtest, overidpre(4) 

You requested pretrend test with the first 4 coefficients, but there are only 2 available pre-event coefficients af
> ter trend adjustment with OLS method.

The pretrend test will account only the 2 available pre-event coefficients.

Overidentification test for pretrends: 2 pre-event coefficients are 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    1.98
            Prob > F =    0.1386

. 
. ************ pre,post, overidpre, overidpost (xteventtest's expected error)
. qui xtevent ln_w age c.age#c.age ttl_exp c.ttl_exp#c.ttl_exp tenure , pol(union2) overidpre(5) pre(0) post(8) ove
> ridpost(2) cluster(idcode) impute(stag) trend(-5, method(ols) saveoverlay) 

. *expected error
. cap noisily xteventtest, overid

Cannot test pretrends if there are 0 available pre-event coefficients after trend adjustment with OLS method.

. 
. ****** savek 
. cap drop myvars*

. qui xtevent ln_w age c.age#c.age ttl_exp c.ttl_exp#c.ttl_exp tenure , pol(union2) w(-5 9) cluster(idcode) impute(
> stag) trend(-3, method(ols) saveoverlay) savek(myvars)

. 
. xteventtest, coefs(1 2)

 ( 1)  _k_eq_p1 = 0
 ( 2)  _k_eq_p2 = 0

       F(  2,   711) =    1.92
            Prob > F =    0.1476

. xteventtest, allpre  

Test for all pre-event coefficients = 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    1.98
            Prob > F =    0.1386

. xteventtest, allpost 

Test for all post-event coefficients = 0

 ( 1)  _k_eq_p0 = 0
 ( 2)  _k_eq_p1 = 0
 ( 3)  _k_eq_p2 = 0
 ( 4)  _k_eq_p3 = 0
 ( 5)  _k_eq_p4 = 0
 ( 6)  _k_eq_p5 = 0
 ( 7)  _k_eq_p6 = 0
 ( 8)  _k_eq_p7 = 0
 ( 9)  _k_eq_p8 = 0
 (10)  _k_eq_p9 = 0

       F( 10,   711) =    6.01
            Prob > F =    0.0000

. xteventtest, constanteff 

Test for constant post-event coefficients

 ( 1)  _k_eq_p0 - _k_eq_p1 = 0
 ( 2)  _k_eq_p0 - _k_eq_p2 = 0
 ( 3)  _k_eq_p0 - _k_eq_p3 = 0
 ( 4)  _k_eq_p0 - _k_eq_p4 = 0
 ( 5)  _k_eq_p0 - _k_eq_p5 = 0
 ( 6)  _k_eq_p0 - _k_eq_p6 = 0
 ( 7)  _k_eq_p0 - _k_eq_p7 = 0
 ( 8)  _k_eq_p0 - _k_eq_p8 = 0
 ( 9)  _k_eq_p0 - _k_eq_p9 = 0

       F(  9,   711) =    2.40
            Prob > F =    0.0109

. xteventtest, overid 

Overidentification test for pretrends: 2 pre-event coefficients are 0

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

Overidentification test for pretrends: 2 pre-event coefficients are 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    1.98
            Prob > F =    0.1386

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

 ( 1)  - _k_eq_p8 + _k_eq_p9 = 0

       F(  1,   711) =    1.32
            Prob > F =    0.2504

Joint overidentification test

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0
 ( 3)  - _k_eq_p8 + _k_eq_p9 = 0

       F(  3,   711) =    1.37
            Prob > F =    0.2514

. xteventtest, overidpre(2) 

Overidentification test for pretrends: 2 pre-event coefficients are 0

 ( 1)  _k_eq_m5 = 0
 ( 2)  _k_eq_m4 = 0

       F(  2,   711) =    1.98
            Prob > F =    0.1386

. xteventtest, overidpost(2)

Overidentification test for effects leveling off: 2 last post-event coefficients are equal

 ( 1)  - _k_eq_p8 + _k_eq_p9 = 0

       F(  1,   711) =    1.32
            Prob > F =    0.2504

. 
. log close 
      name:  <unnamed>
       log:  C:\Users\tino_\Dropbox\PC\Documents\xtevent\issues\166\test issue 166.txt
  log type:  text
 closed on:  26 Oct 2023, 02:00:32
-------------------------------------------------------------------------------------------------------------------
